<!DOCTYPE html>
<html lang="en" style="height: 100%; width: 100%;">

<head>
    <meta charset="UTF-8">
    <title>Retrieve Image File</title>

    <link rel="stylesheet" href="../../stylesheets/platform_styleVariables_turquoise.css" />
    <link rel="stylesheet" href="../../stylesheets/platform_styles.css">
    <link rel="stylesheet" href="../../stylesheets/popUpCard_styles.css" />

    <style>
        .popUpDivision {
            padding: 0;
        }

        .formTitleContainer {
            padding: 20px;
        }

        .formTitleContainer, .formControlsContainer {
            background-color: var(--formTitleControlsContainerBackgroundColor);
        }
        
        .formFieldsContainer {
            overflow: hidden;
            padding: 0;
        }

        .imageController {
            height: 100%;
            width: 100%;

            object-fit: cover;
            object-position: center center;
        }
    </style>

    <script>
        //@ts-check
        //Prevent contextMenu
        window.addEventListener("contextmenu", (event) => {
            event.preventDefault();
        });
        //Add onload to window for initializing popUpCardInterface
        window.addEventListener("load", () => {
            window.popUpCardInterface = new PopUpCardInterface();
        });

        class PopUpCardInterface {
            constructor() {
                //FIELD DECLARATIONS
                this.popUpCardObject = null;
                //Cache elements
                this.closeButtons = document.querySelectorAll(".closeButton");
                this.imageController = document.getElementById("imageController");
                //INITIATION PROCEDURE
            }

            preview(imageFilePath) {
                //Fetch itemPaths in the subDirectoryPath
                fetch(`${location.protocol}//${location.host}/file/fileBuffer?filePath=${encodeURIComponent(imageFilePath)}`)
                .then(response => response.json())
                .then(response => {
                    if (response.status) {
                        this.imageController.src = URL.createObjectURL(new Blob([new Uint8Array(response.fileBuffer.data)]));
                        //Update titleDescription with fileName
                        document.querySelector(".title").textContent = imageFilePath.slice(imageFilePath.lastIndexOf("/") + 1, imageFilePath.lastIndexOf("."));
                    } else {
                        window.parent.shellInterface.throwAlert(response.error.title, response.error.titleDescription, response.error.message, null, "OK", null);
                    }
                })
                .catch(error => {
                    window.parent.shellInterface.throwAlert("Oops! We couldn't fetch that", "Contact your system administrator", "We couldn't fetch required file from the internal server. The most likely cause may be a network failure. If it is not the case, provide your system administrator with the following error\n\n" + error, null, "OK", null);
                });
            }
        }
    </script>
</head>

<body>
    <div class="popUpDivision">
        <!-- formTitleContainer -->
        <div class="formTitleContainer">
            <div class="titleContainer">
                <div class="title">Loading...</div>
            </div>
        </div>

        <!-- formFieldsContainer -->
        <div class="formFieldsContainer">
            <img id="imageController" class="imageController" />
        </div>

        <!-- formControlsContainer -->
        <div class="formControlsContainer">
            <button class="buttonText buttonText-link closeButton">CLOSE</button>
        </div>
    </div>
</body>

</html>